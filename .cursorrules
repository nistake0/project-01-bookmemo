# Cursor Development Rules for BookMemo Project

## 開発開始時の必須手順

新しい開発セッションを開始する際は、必ず以下の手順を実行してください：

### 1. 開発開始プロンプトの確認
`doc/development-startup-prompts.md` ファイルを確認し、記載されているプロンプトを順番に実行してください。
**プロジェクト最優先目標**: `doc/discussion-user-profile-and-theme-tasks.md` を必ず確認し、タスクA→B→C の方針に従って開発を進めてください。

### 2. プロンプトの内容
1. **プロジェクト状況確認**: README.md、ARCHITECTURE.md、docのドキュメント群から、プロジェクトの目的、方針、設計、現在の状況の確認
2. **テスト状況確認**: unit test と e2e テストの確認
3. **開発方針議論**: これからの開発方針を議論

## プロジェクト概要
- **目的**: Cursorによる100%自動生成開発の実証
- **技術**: React + Firebase + Material-UI
- **アプリ**: 読書メモ管理Webアプリケーション

## 重要なドキュメント
- `README.md` - プロジェクト概要
- `ARCHITECTURE.md` - 設計・技術詳細
- `doc/` - 開発記録・日報
- `doc/development-startup-prompts.md` - 開発開始時の必須プロンプト
- **`doc/discussion-user-profile-and-theme-tasks.md`** - **プロジェクト最優先目標**（ユーザー設定・テーマ・プロフィール。開発開始時・実装前に必ず確認）

## 開発方針
- 技術的課題と新機能を並行開発
- テスト品質の維持
- ユーザー体験の向上

## コードレビュー優先事項 ⚠️

### 必須確認項目（開発開始時・機能追加前）
**コードレビュー報告書を必ず確認**: `doc/code-review-20260117.md`

**優先度: 高の改善項目**:
1. **デバッグログの本番対応** - `console.log`が279箇所に存在
   - 環境変数で制御するロガー関数の作成
   - 本番環境ではログを出力しない設定
   - 参考: `doc/code-review-20260117.md` セクション8.1

**優先度: 中の改善項目**:
2. **MemoAdd.jsxの状態管理改善** - 8つの状態変数の整理
3. **戻る操作の不具合調査と修正** - メモ詳細や検索画面での戻る操作

**確認方法**:
- 新機能開発前に `doc/code-review-20260117.md` を確認
- 技術的負債の解消を継続的に実施
- コード品質メトリクスを定期的に確認

## セキュリティ重要事項 ⚠️

### 環境変数ファイルの管理
- **絶対にGitにコミットしない**: `.env`、`.env.local`、`.env.development`、`.env.production`、`.env.test`
- **`.gitignore`の確認**: 環境変数ファイルが含まれていることを必ず確認
- **機密情報の漏洩リスク**: APIキー、パスワード、トークン等の漏洩は重大なセキュリティ問題

### セキュリティチェック手順
開発開始時およびコミット前に以下を実行：
```bash
# 環境変数ファイルがGit管理されていないか確認
git ls-files | grep -E "\.env"

# 機密情報が含まれていないか確認
git log --all --full-history -- "*.env"
```

### 環境変数の適切な管理
- **ローカル開発**: `.env.local`（Git管理外）
- **本番環境**: GitHub Secrets
- **チーム共有**: `.env.example`テンプレート
- **テスト環境**: `.env.test`（Git管理外）

### 既にコミットされた機密情報の対処
機密情報がGitにコミットされた場合：
1. 即座に`git rm --cached <file>`で削除
2. `git filter-branch`で履歴から完全削除
3. 強制プッシュでリモートリポジトリも更新
4. 漏洩した機密情報は即座に再発行

## テスト実行時の注意事項
- **E2Eテスト実行前には必ず開発サーバー（`npm run dev`）を起動してください**
- ユニットテストは`npm run test:unit`で実行
- E2Eテストは`npm run test:e2e`で実行（開発サーバー起動後）
- 全テスト実行は`npm run test:all`で実行

### テスト記述方針
- コンポーネントテストでは `data-testid` や役割属性を優先し、UI表示文字列に依存しないセレクタを利用する。
- 実装コードの表示文言を `getByText` などで直接参照しない。必要に応じてテスト専用IDや状態属性を追加する。
- バリデーションや状態判定も、表示文字列ではなく付与した`data-state`等の属性で確認する。
- テスト追加時も上記方針に合うよう既存コンポーネントへ最小限の test-id を付与して対応する。

## コミットメッセージ運用ルール
- すべてのコミットメッセージは**日本語**で記述する
- 先頭にカテゴリ（例: `feat`, `fix`, `docs`, `refactor`, `test`, `chore` など）を付ける
- 要約は50文字程度に収め、必要なら本文で詳細を記載

## サブエージェント自動使用ルール 🤖

### アート・グラフィック関連タスクの自動ルーティング

以下のキーワードやタスクが含まれる場合、**自動的に `artistic-graphics` サブエージェントを使用する**:

#### 自動使用トリガー（キーワード）
- **背景**: "背景", "background", "背景画像", "library background", "bookshelf"
- **装飾**: "装飾", "decoration", "デザイン", "見た目", "アート", "artistic"
- **カード**: "カードの透明度", "card transparency", "ガラス", "glassmorphism"
- **ヘッダー**: "ヘッダー装飾", "header decoration", "PageHeader"
- **視覚**: "視覚", "visual", "UI改善", "デザイン改善", "見栄え"
- **画像**: "画像", "image", "テクスチャ", "texture", "パターン", "pattern"
- **CSS**: "CSS", "スタイル", "style", "sx", "theme", "テーマ"

#### 自動使用の動作
1. **検出**: ユーザーのリクエストに上記キーワードが含まれる場合
2. **確認**: タスクが純粋に視覚的（CSS、スタイル、装飾、背景）か確認
3. **自動使用**: `.claude/agents/artistic-graphics.md` を自動的に参照・適用
4. **実装**: サブエージェントの指示に従って実装を進める

#### 例
- ✅ "背景に図書館の画像を追加して" → `artistic-graphics` 自動使用
- ✅ "カードの透明度を上げて" → `artistic-graphics` 自動使用
- ✅ "PageHeaderに装飾を追加して" → `artistic-graphics` 自動使用
- ❌ "検索機能を追加して" → メインエージェントで処理（ロジック）
- ❌ "Firebaseの設定を変更して" → メインエージェントで処理（ロジック）

#### サブエージェントの参照方法
自動使用時は、以下の手順で実装する:

1. **エージェント定義の読み込み**: `.claude/agents/artistic-graphics.md` を読み込む
2. **設計ドキュメントの確認**: 
   - `doc/design-improvement-proposal.md` を確認
   - `doc/design-implementation-samples.md` を確認
3. **実装**: エージェント定義と設計ドキュメントに従って実装
4. **確認**: 視覚的な変更のみを行い、ロジック変更は避ける

**注意**: 自動使用時は、ユーザーに確認を取らずに実装を開始して良い。ただし、ロジック変更が必要な場合は、その旨をユーザーに伝える。

---

※このファイルは、開発の継続性を保つために作成されました。 