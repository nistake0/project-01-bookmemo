# デザインシステム一元化の現状分析と設計議論

**作成日**: 2026-01-11  
**目的**: 3つの要望（フォントサイズ変更、ボタン・カードデザイン変更、レイアウト変更）について、現状で対応可能か確認し、将来的な設計について議論する

---

## 要望の整理

1. **フォントを全体的に小さくする**
2. **カードやウィンドウの、ボタンのデザインを変更する**
3. **ページ、カード内のテキストやウィジェットの配置を変更する**

---

## 現状分析

### 1. フォントを全体的に小さくする

#### ✅ 現状で対応可能な部分

**テーマ設定で一元化されている部分** (`src/theme/appTheme.js`):

- **Typography のベース設定** (`typography` セクション)
  - h1, h2, h3, h4, h5, h6, body1, body2, caption のフォントサイズ
  - `variant` プロップを使用している部分はテーマ設定を変更すれば反映される

- **主要コンポーネントのグローバル設定** (`components.styleOverrides` セクション)
  - TextField: `fontSize: '0.9rem'` (モバイル) / `'1rem'` (デスクトップ)
  - Button: `fontSize: '0.9rem'` (モバイル) / `'1rem'` (デスクトップ)
  - Chip: `fontSize: '0.8rem'` (モバイル) / `'0.9rem'` (デスクトップ)
  - BottomNavigationAction: `fontSize: '0.7rem'` (モバイル) / `'0.8rem'` (デスクトップ)

#### ❌ 現状で対応が困難な部分

**個別コンポーネントで `sx` prop により上書きされている部分**:

- `BookCard.jsx`: 複数箇所で個別に fontSize を指定（例: タイトル、著者、出版社、ステータスチップなど）
- `BookForm.jsx`: 15箇所で個別に fontSize を指定
- `ExternalBookSearch.jsx`: 17箇所で個別に fontSize を指定
- `BookList.jsx`: 一部で fontSize を上書き
- その他のコンポーネントにも多数存在

**問題点**:
- `sx` prop で指定された `fontSize` は、テーマ設定を上書きするため、テーマ変更が反映されない
- 個別コンポーネントごとに手動で修正する必要がある

#### 現状での対応方法

**方法1: テーマ設定の変更（部分的に効果がある）**
- `appTheme.js` の `typography` セクションを変更
- `components.styleOverrides` を変更
- → これだけでは、個別コンポーネントで上書きされている部分は変更されない

**方法2: 完全に一元化する（推奨されるが作業量が多い）**
- 個別コンポーネントの `sx` prop から `fontSize` を削除
- Typography の `variant` を適切に使用する
- 必要最小限の上書きのみを残す

#### 評価

- **現状での対応可能性**: ⚠️ **部分的に可能（約60-70%）**
- **一元化の程度**: 中程度（テーマ設定で定義されている部分は変更可能、個別上書きが多い）
- **対応作業量**: 中程度（テーマ設定のみなら軽微、完全一元化なら大規模）

---

### 2. カードやウィンドウの、ボタンのデザインを変更する

#### ✅ 現状で対応可能な部分

**テーマ設定で一元化されている部分** (`src/theme/appTheme.js`):

- **Button のスタイル** (`components.MuiButton.styleOverrides`)
  - fontSize, padding が定義されている
  - モバイル/デスクトップのレスポンシブ対応も含まれている

- **Card のスタイル** (`components.MuiCard.styleOverrides`)
  - height, display, flexDirection, marginBottom が定義されている

- **CardContent のスタイル** (`components.MuiCardContent.styleOverrides`)
  - padding が定義されている（モバイル/デスクトップ対応）

- **Dialog のスタイル** (`components.MuiDialog.styleOverrides`)
  - margin, width, maxWidth が定義されている

#### ❌ 現状で対応が困難な部分

**個別コンポーネントで `sx` prop により上書きされている部分**:

- ボタンの場合:
  - 各コンポーネントで `sx` prop を使って個別にスタイルを指定している可能性
  - 例: `BookForm.jsx` などでボタンのスタイルを個別に指定している可能性

- カードの場合:
  - `BookCard.jsx`: CardContent の padding を個別に上書き（`sx={{ p: { xs: 1.5, sm: 2 } }}`）
  - カード内のレイアウト（flexbox, gap など）が個別コンポーネントで定義されている

- Dialog/ウィンドウの場合:
  - Dialog コンテンツ内のレイアウトが個別コンポーネントで定義されている

#### 現状での対応方法

**方法1: テーマ設定の変更（主要部分は変更可能）**
- `components.MuiButton.styleOverrides` を変更 → ボタンの主要なスタイルは変更可能
- `components.MuiCard.styleOverrides` を変更 → カードの主要なスタイルは変更可能
- `components.MuiDialog.styleOverrides` を変更 → ダイアログの主要なスタイルは変更可能
- → ただし、個別コンポーネントで上書きしている部分は変更されない

**方法2: 個別コンポーネントの修正（完全対応）**
- 各コンポーネントの `sx` prop を個別に修正
- → 作業量が多い

#### 評価

- **現状での対応可能性**: ✅ **比較的容易（約80-90%）**
- **一元化の程度**: 高い（主要コンポーネントのスタイルはテーマ設定で定義されている）
- **対応作業量**: 軽微（テーマ設定のみなら軽微、完全対応なら中程度）

---

### 3. ページ、カード内のテキストやウィジェットの配置を変更する

#### ✅ 現状で対応可能な部分

**テーマ設定で一部定義されている部分**:

- **spacing** (`spacing` セクション)
  - 基本スペーシングユニット: `4px * factor`
  - これを使用している部分は変更可能

- **Card の基本レイアウト** (`components.MuiCard.styleOverrides`)
  - `display: 'flex'`, `flexDirection: 'column'` が定義されている

#### ❌ 現状で対応が困難な部分

**個別コンポーネントで `sx` prop により定義されている部分**:

- **グリッドレイアウト**:
  - `BookList.jsx`: `gridTemplateColumns` が個別に定義（`{ xs: '1fr', sm: 'repeat(2, 1fr)', md: 'repeat(3, 1fr)', lg: 'repeat(4, 1fr)' }`）
  - `gap` も個別に定義（`{ xs: 1.5, sm: 2 }`）

- **フレックスボックスレイアウト**:
  - `BookCard.jsx`: 内部レイアウトが個別に定義（flexbox, gap, margin など）
  - 各ページコンポーネント: レイアウトが個別に定義

- **パディング・マージン**:
  - 各コンポーネントで個別に定義（`px`, `py`, `mt`, `mb` など）

- **コンテンツの配置**:
  - `textAlign`, `alignItems`, `justifyContent` などが個別に定義

#### 現状での対応方法

**方法1: テーマ設定の変更（限定的）**
- `spacing` を変更 → これを使用している部分のみ変更可能
- → ただし、多くの箇所で直接数値を指定しているため、影響範囲は限定的

**方法2: 個別コンポーネントの修正（完全対応）**
- 各コンポーネントの `sx` prop を個別に修正
- → 作業量が非常に多い

#### 評価

- **現状での対応可能性**: ❌ **困難（約20-30%）**
- **一元化の程度**: 低い（レイアウト/配置が個別コンポーネントに散在している）
- **対応作業量**: 大規模（個別修正が必要）

---

## 設計の課題と改善案

### 現状の設計の問題点

1. **フォントサイズ**:
   - テーマ設定で一部定義されているが、多くのコンポーネントで個別に上書きされている
   - 完全な一元化には、個別コンポーネントの修正が必要

2. **ボタン・カードのデザイン**:
   - 主要コンポーネントのスタイルはテーマ設定で定義されている
   - ただし、個別コンポーネントで上書きしている部分が存在する

3. **レイアウト/配置**:
   - ほとんどが個別コンポーネントで定義されている
   - テーマ設定での一元化が進んでいない

### 理想的な設計の方向性

#### 1. フォントサイズの完全一元化

**目標**: すべてのフォントサイズをテーマ設定で管理

**実現方法**:
- Typography の `variant` を適切に使用する
- 個別コンポーネントの `sx` prop から `fontSize` を削除
- どうしても個別調整が必要な場合は、テーマの `typography` に新しい variant を追加

**メリット**:
- テーマ設定を変更するだけで、全体のフォントサイズを変更可能
- 一貫性の向上

**デメリット/課題**:
- 作業量が多い（多くのコンポーネントを修正する必要がある）
- 意図的な個別調整が必要な場合の扱いが難しい

#### 2. ボタン・カードデザインの一元化

**目標**: すべてのボタン・カードのスタイルをテーマ設定で管理

**実現方法**:
- テーマの `components.styleOverrides` で可能な限り定義
- 個別コンポーネントでの上書きを最小限にする
- 必要に応じて、テーマに新しい variant や props を追加

**メリット**:
- テーマ設定を変更するだけで、デザインを変更可能
- 一貫性の向上

**デメリット/課題**:
- 一部の個別調整が必要な場合の扱いが難しい
- テーマ設定が複雑になる可能性

#### 3. レイアウト/配置の一元化

**目標**: 共通レイアウトパターンをテーマ設定または共通コンポーネントで管理

**実現方法（複数のアプローチが考えられる）**:

**アプローチA: テーマ設定での一元化（限定的）**
- 共通の spacing, gap をテーマ設定で定義
- → ただし、グリッドカラム数などは個別調整が必要なため、完全な一元化は困難

**アプローチB: 共通レイアウトコンポーネントの作成**
- グリッドレイアウト用の共通コンポーネントを作成
- カードレイアウト用の共通コンポーネントを作成
- → レイアウトパターンをコンポーネント化することで、変更を一箇所に集約

**アプローチC: デザイントークンの拡充**
- レイアウト関連の値をデザイントークンとして定義（例: `layout.gridColumns`, `layout.cardGap` など）
- 各コンポーネントでこのトークンを参照
- → トークンを変更するだけで、全体のレイアウトを変更可能

**メリット**:
- レイアウト変更が容易になる
- 一貫性の向上

**デメリット/課題**:
- アプローチB: 共通コンポーネントの設計・実装が必要
- アプローチC: トークン定義の設計・実装が必要
- いずれも作業量が多い

---

## 推奨される改善アプローチ

### 短期対応（現状の設計を活かす）

1. **フォントサイズ変更**:
   - テーマ設定の `typography` と `components.styleOverrides` を変更
   - → 約60-70%の部分は変更可能
   - 残りの部分は、必要に応じて個別修正

2. **ボタン・カードデザイン変更**:
   - テーマ設定の `components.styleOverrides` を変更
   - → 約80-90%の部分は変更可能
   - 残りの部分は、必要に応じて個別修正

3. **レイアウト/配置変更**:
   - 個別コンポーネントの修正が必要
   - → 現状では一元的な変更は困難

### 中期対応（設計改善）

1. **フォントサイズの完全一元化**:
   - Task 3.1 の延長として、個別コンポーネントの `fontSize` 上書きを段階的に削除
   - Typography の `variant` を適切に使用

2. **ボタン・カードデザインの一元化**:
   - 個別コンポーネントでの上書きを最小限にする
   - テーマ設定での定義を強化

3. **レイアウト/配置の部分的一元化**:
   - デザイントークンの拡充（spacing, gap など）
   - 共通レイアウトパターンの特定とコンポーネント化

### 長期対応（理想的設計）

1. **デザインシステムの構築**:
   - デザイントークンの完全な定義（色、タイポグラフィ、スペーシング、レイアウト）
   - すべてのコンポーネントがデザイントークンを参照する設計

2. **コンポーネント設計の見直し**:
   - レイアウトコンポーネントの共通化
   - スタイルの継承・拡張パターンの統一

---

## まとめ

### 現状での対応可能性

| 要望 | 対応可能性 | 一元化の程度 | 対応作業量 |
|------|----------|------------|-----------|
| フォントサイズ変更 | ⚠️ 部分的に可能（60-70%） | 中程度 | 中程度 |
| ボタン・カードデザイン変更 | ✅ 比較的容易（80-90%） | 高い | 軽微 |
| レイアウト/配置変更 | ❌ 困難（20-30%） | 低い | 大規模 |

### 今後の設計方針の検討事項

1. **どこまで一元化するか？**
   - 完全一元化: 理想的だが作業量が多い
   - 部分的一元化: 現実的だが、一部は個別修正が必要
   - 現状維持: 変更作業量が多い

2. **レイアウト/配置の一元化アプローチ**
   - テーマ設定での一元化（限定的）
   - 共通コンポーネントの作成
   - デザイントークンの拡充
   - → どれを採用するか検討が必要

3. **個別調整の扱い**
   - 完全一元化した場合、個別調整が必要な場合の扱い
   - variant の追加、props の拡張などの方法

---

## 参考資料

- `src/theme/appTheme.js`: テーマ設定
- `doc/ui-design-font-size-analysis.md`: フォントサイズ一元化の現状分析
- `doc/ui-design-improvement-project-completion.md`: UIデザイン改善プロジェクト完了報告
- `doc/ui-design-improvement-plan-20260111.md`: UIデザイン改善計画
