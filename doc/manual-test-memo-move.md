# メモ移動機能 手動確認ガイド

## 概要
- 単一メモを別書籍へ移動する UX の正常動作を人手で確認するための手順を記録する。
- 対象: `MemoEditor` に追加した「移動」ボタン、および `MemoMoveDialog`（書籍検索・バリデーション・移動処理）。

## 前提条件
- 開発ブランチの最新変更を反映済み。
- `npm install` 済み。
- Firebase テスト用データベースにアクセス可能で、少なくとも 2 冊以上の書籍が存在し、それぞれに作成済みメモがあること。
  - 書籍が足りない場合は事前に UI から追加する。
- ブラウザは Chrome 最新版を推奨。

## 環境セットアップ
1. 開発サーバーを起動  
   ```bash
   npm run dev
   ```  
   （`https://localhost:5173/` にアクセス可能であることを確認）

2. ログイン
   - テストユーザーでサインイン。
   - ログイン後、書籍一覧が表示されることを確認。

## 手順と期待結果

### 1. メモ詳細ダイアログを開く
1. 書籍一覧または検索結果から移動元の書籍を開く。
2. メモ一覧から任意のメモカードをタップし、`MemoEditor`（メモ詳細）を表示する。  
   - 期待結果: ダイアログ右下に「移動」「編集」「削除」「閉じる」ボタンが並ぶ。

### 2. 移動先選択
1. 「移動」ボタンをクリック。`MemoMoveDialog` が表示される。
2. ダイアログ上部に対象メモの概要・説明文が表示されることを確認。  
   - `対象メモ` ボックスに本文要約/コメント/作成日時が表示される。
   - 案内文「誤って別の書籍に作成したメモを移動します…」が表示される。

3. オートコンプリートにフォーカスし、タイトル or 著者で検索。  
   - 期待結果: 書籍候補が表示され、タイトル・著者・ステータス Chip が確認できる。

### 3. バリデーション確認
1. 移動先を選択せずに「移動する」を押す。  
   - 期待結果: 「移動先の書籍を選択してください」エラーがフォーム下に表示される。
2. 現在の書籍（移動元）を選択する。  
   - 期待結果: エラー「同じ書籍には移動できません。」が表示され、「移動する」ボタンが Disabled になる。

### 4. 正常系搬送
1. 移動先として別書籍を選択し、「移動する」をクリック。  
   - 成功時: ダイアログが閉じ、メモ詳細ダイアログも自動的に閉じる。
   - 書籍一覧または詳細を更新すると、移動元書籍からメモが消え、移動先書籍に追加されている。  
   - タグ履歴や検索結果のキャッシュがクリアされ、再検索時に新しい書籍IDでヒットすることを確認する。

### 5. 失敗系（オプション）
- Firestore ルール等でわざと失敗させる場合、移動前にネットワーク遮断などの手段を取る。  
  - 期待結果: ダイアログ内に「メモの移動に失敗しました。」が表示され、ボタンが再び有効化される（閉じずに留まる）。

## 追加確認
- 書籍が 1 冊のみの場合：オートコンプリートが Disabled、ボタンも Disabled であること。
- 書籍取得エラー（ネットワーク断など）：エラーアラートと「再読み込み」ボタンが表示され、クリックすると再取得が走ること。
- モバイル幅（DevTools でレスポンシブ表示）でも UI が崩れないこと。

## 後片付け
1. 実際に移動したメモを元に戻す場合は、再度同じ手順で移動先→移動元へ戻す。
2. 開発サーバー停止  
   ```bash
   Ctrl+C
   ```

## 備考
- 必要に応じて、今回のテスト実施日時と結果を `doc/daily/` の日報に記録する。
- 追加の E2E 自動化シナリオを検討する際は、本ガイドを共通仕様として参照する。
