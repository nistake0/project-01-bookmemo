# バグ・改善案・TODOメモ

## バグ
- [x] メモ追加画面（書籍詳細画面）で、書籍のタグが表示されていない。（2024-06-27修正済み）
- [x] スマホでカメラ起動→バーコード読み取り機能がすぐ終了し、カメラ映像が表示されない（カメラ許可・ストリーム取得・UIバグ等の可能性あり）（2024-06-27修正済み）
- [x] 書籍詳細ページでタグの追加・修正・削除ができない（現状は表示のみ）。（2024-06-27修正済み）
  - BookAdd時のみタグ設定可能。編集機能を追加する場合はUI・Firestore更新処理の実装が必要。
- [x] 書籍詳細画面で、フッタメニューが画面の縦スクロールで画面外に消えて操作できなくなる。（2024-07-20発見、2024-07-20修正済み）
- [x] 書籍詳細画面の、一番上の書籍の情報表示が、縦書きになっていて、情報が正しく把握できないレイアウトになっている。（2024-07-20発見、2024-07-20修正済み）

## 機能追加・改善案
- [x] 書籍の追加日時、読了日時を表示したい。（2024-06-27修正済み）
- [x] メモの追加日時を表示したい。（2024-06-27修正済み）
- [x] メモの全文が表示されるので、メモが見づらい。リストはページや引用の先頭部分だけにして、メモの詳細は別ページにするかダイアログ・カードなどで表示されるようにしたい。（2024-06-27修正済み）

## 技術的課題・調査
- [x] 共通エラーダイアログをBookAdd以外の画面（BookDetail, MemoAdd, MemoList等）にも適用し、重要なエラーはsetGlobalErrorで通知するようリファクタ（2024-06-27修正済み）
- [ ] 統計・ダッシュボード機能の設計・技術調査、マイページ機能のUI設計、他サービス連携やデータエクスポートの検討

## メモ表示・編集UI/UX改善（2024-06-27追記）
- [x] メモ一覧で「いつ追加したメモか」が分からない。追加日時を表示する。（2024-06-27修正済み）
- [x] メモ本文や引用が長い場合、1件の表示が大きすぎて一覧性が悪い。先頭数行だけ表示し、全文は詳細・ダイアログで見せる。（2024-06-27修正済み）
- [x] メモ本文や引用が長い場合、修正・削除ボタンが見えなくなる、フッターナビゲーションが隠れる等のUI崩れが発生する。カード化・高さ制限・スクロール等で改善。（2024-06-27修正済み）
- [x] メモ編集ウィンドウのレイアウト・デザインが悪い。横にはみ出す、エラーダイアログとデザインが統一されていない等。共通デザイン化・レイアウト修正。（2024-06-27修正済み）
- [x] 上記の各項目について、対応方針・実装状況・完了日などをこのメモで管理する。（2024-06-27修正済み）

## 修正内容詳細（2024-06-27）

### メモ追加画面のタグ表示バグ修正
- **修正内容**: 
  - BookDetail.jsx: 書籍のタグ情報をMemoAddコンポーネントに渡すように修正
  - MemoAdd.jsx: 受け取った書籍のタグを表示し、デフォルト値として設定
- **実装詳細**:
  - 書籍詳細画面で書籍のタグをChipコンポーネントで表示
  - メモ追加画面で「書籍のタグ:」として表示
  - メモ追加時のタグ入力欄に書籍のタグを初期値として設定
- **効果**: ユーザーが書籍のタグを確認しながらメモを追加できるようになった

### 共通エラーダイアログの拡張
- **修正内容**:
  - BookDetail.jsx: 書籍取得・ステータス更新エラーの通知
  - MemoAdd.jsx: タグ履歴取得・保存・メモ追加エラーの通知
  - MemoList.jsx: メモ一覧取得・更新・削除エラーの通知
- **実装詳細**:
  - ErrorDialogContextを使用したグローバルエラー通知
  - 各コンポーネントでtry-catch文にsetGlobalErrorを追加
  - ユーザーフレンドリーなエラーメッセージの設定
- **効果**: エラー処理の統一性向上、ユーザー体験の改善

### 書籍詳細ページのタグ編集機能
- **修正内容**:
  - BookDetail.jsx: タグ編集ダイアログの追加
  - タグ履歴取得・保存機能の実装
  - タグ編集UIの実装
- **実装詳細**:
  - タグ横の編集アイコンをクリックでダイアログを開く
  - Autocompleteコンポーネントでタグの追加・削除・編集
  - 書籍用タグ履歴（bookTagHistory）の管理
  - Firestoreでのタグ更新処理
- **効果**: 書籍のタグを後から編集できるようになった

## 修正内容詳細（2024-07-20）

### Phase 3 リファクタリングで発見された不具合

#### 1. フッタメニューのスクロール問題
- **問題**: 書籍詳細画面で、フッタメニューが画面の縦スクロールで画面外に消えて操作できなくなる
- **原因**: フッタメニューの固定位置設定が不適切、またはスクロール時の表示制御に問題
- **影響**: ユーザーがナビゲーションできなくなり、他の画面に移動できない
- **優先度**: 高（基本的なナビゲーション機能の障害）

#### 2. 書籍情報表示のレイアウト問題
- **問題**: 書籍詳細画面の一番上の書籍の情報表示が、縦書きになっていて、情報が正しく把握できないレイアウトになっている
- **原因**: CSS の writing-mode 設定やレイアウトの不適切な設定
- **影響**: ユーザーが書籍の基本情報（タイトル、著者、出版社など）を正しく読めない
- **優先度**: 中（表示の問題だが、基本機能に影響）

### 対応方針
1. **フッタメニュー問題**: 
   - フッタの固定位置設定を確認・修正
   - z-index の調整
   - スクロール時の表示制御の改善

2. **書籍情報レイアウト問題**:
   - CSS の writing-mode 設定を確認
   - レイアウトの方向性を横書きに修正
   - レスポンシブデザインの確認

### 修正内容詳細（2024-07-20）

#### 1. フッタメニューのスクロール問題修正
- **修正内容**: 
  - App.jsx: zIndex を 100 → 1000 に変更
  - App.jsx: 背景色とボーダーを追加
  - BookDetail.jsx: パディングを pb: '56px' → pb: '80px' に変更
- **効果**: フッタメニューが他の要素より前面に表示され、スクロール時も操作可能

#### 2. 書籍情報表示のレイアウト問題修正
- **修正内容**:
  - BookDetail.jsx: BookInfo と BookStatusChanger を縦並びに変更
  - BookInfo.jsx: 読書中表示を中央揃えに変更
  - BookInfo.jsx: 書籍情報を左揃えに変更
- **効果**: 書籍情報が縦に並び、読みやすいレイアウトになった

---

※バグ・細かい機能追加・技術的な疑問やTODOなど、思いついたことを随時ここにメモしてください。 