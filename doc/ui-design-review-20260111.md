# UIデザイン改善のための現状レビュー

**作成日**: 2026-01-11  
**目的**: UIデザイン改善に向けて、現在のアプリのデザイン構造とコーディング状況を把握する

## レビュー概要

UIデザインを改善するため、以下の観点で現状をレビュー：
1. テーマ設定の一元管理状況
2. スタイリング手法の統一性
3. デザイン変更時の影響範囲（テストコードのデザイン独立性）
4. ハードコードされた値の有無

---

## 1. テーマ設定の問題

### 1.1 テーマ定義の重複

**問題**: テーマが2箇所で定義されているが、実際に使用されているのは1つだけ

- **`src/main.jsx`**: 詳細なテーマ定義（219行）が存在するが、**使用されていない**
- **`src/theme/appTheme.js`**: シンプルなテーマ定義（120行）が実際に使用されている（`App.jsx`でインポート）

**影響**:
- テーマ設定が分散しており、一元管理されていない
- `main.jsx`の詳細な設定（フォントサイズ、コンポーネントオーバーライドなど）が反映されない
- デザイン変更時にどちらのファイルを修正すべきか混乱する可能性

**推奨対応**:
- `main.jsx`のテーマ定義を削除し、`appTheme.js`を一元管理にする
- または、`appTheme.js`の設定を`main.jsx`の詳細設定に統合する

### 1.2 テーマ設定の不足

**現状**: `appTheme.js`は基本的な設定のみで、以下の詳細設定が不足
- フォントファミリーの統一設定
- 詳細なコンポーネントオーバーライド（`main.jsx`には存在）
- カラーパレットの拡張（背景色、テキスト色の詳細設定など）

---

## 2. スタイリング手法の混在

### 2.1 スタイリング手法の種類

| 手法 | 使用状況 | 主な使用箇所 |
|------|---------|------------|
| **sx prop** | ✅ 主要 | ほとんどのコンポーネント（MUI標準） |
| **CSS Modules / クラス名** | ⚠️ 一部 | `TagStats.css`, `Stats.css` |
| **インラインstyle** | ❌ 未使用 | - |
| **styled-components** | ❌ 未使用 | - |

### 2.2 CSSファイルの使用状況

**問題のある箇所**:

1. **`src/components/tags/TagStats.css`**
   - グリッドレイアウト用のクラス（`.tag-stats-grid`, `.tag-stat-card`）
   - `!important`を多用しており、MUIテーマとの競合リスクがある
   - レスポンシブ対応がCSSファイルに記述されており、テーマ設定と分離されている

2. **`src/pages/Stats.css`**
   - 同様にグリッドレイアウト用のクラス（`.stats-summary-grid`, `.stats-summary-card`）
   - `!important`の使用により、テーマ設定の上書きが困難

**影響**:
- テーマ変更時にCSSファイルも手動で修正する必要がある
- MUIの`sx` propを使った方が、テーマとの統合が容易

**推奨対応**:
- CSSファイルを削除し、`sx` propまたはMUIの`Grid`コンポーネントに移行
- グリッドレイアウトはMUIの`Grid`または`Box`の`sx`で実装

### 2.3 ハードコードされた色・値

**問題のあるコンポーネント**:

1. **`src/components/common/PageHeader.jsx`**
   - 多くの色がハードコードされている：
     - `rgba(139, 69, 19, 0.9)` (ブラウン系)
     - `#8B4513`, `#A0522D`, `#CD853F` (グラデーション用)
     - `#FFF8DC`, `#F5F5DC` (テキスト色)
     - `rgba(0,0,0,0.7)` (テキストシャドウ)
   - テーマのカラーパレットを使用していない

2. **`src/index.css`**
   - グローバルスタイルに色がハードコード：
     - `background: #f5f7fa !important;`
     - `color: #222;`
     - フォーカス色: `#1976d2`

**影響**:
- テーマ変更時に複数箇所を修正する必要がある
- デザインシステムとしての統一性が損なわれる
- ダークモード対応が困難

**推奨対応**:
- ハードコードされた色をテーマのカラーパレットに移行
- `index.css`のグローバルスタイルは最小限にし、テーマ設定を優先

---

## 3. テストコードのデザイン独立性

### 3.1 テスト方針との矛盾

**現状の問題**: `.cursorrules`では「テストは実装文字列に依存しない」方針が明記されているが、実際には多数のテストが`getByText()`で実装文字列を直接参照している

**影響を受けやすいテストファイル**（`getByText`を使用）:
- `BookCard.test.jsx`
- `BookForm.test.jsx`
- `ExternalBookSearch.test.jsx`
- `MemoCard.test.jsx`
- `MemoEditor.test.jsx`
- `MemoAdd.test.jsx`
- `FullTextSearch.test.jsx`
- `PWAInstallPrompt.test.jsx`
- `SearchResults.test.jsx`
- `AdvancedSearchForm.test.jsx`

**問題例**:
```javascript
// BookCard.test.jsx
expect(screen.getByText('テスト書籍')).toBeInTheDocument();
expect(screen.getByText('ステータス: 積読')).toBeInTheDocument();
```

**影響**:
- UIテキストを変更するとテストが失敗する
- デザイン変更時のリファクタリングコストが高い
- テストが「デザイン独立」ではなく「実装に密結合」している

**推奨対応**:
- `data-testid`属性を追加し、テストを`getByTestId`ベースに移行
- 表示テキストの検証が必要な場合は、テスト専用の属性（`data-display-text`など）を使用

### 3.2 スタイル・クラス名への依存

**現状**: テストコードは主に`data-testid`を使用しており、クラス名やスタイル属性への依存は少ない

**良好な点**:
- 新規コンポーネント（`BookEditDialog`, `MemoMoveDialog`など）は`data-testid`を適切に使用
- `.cursorrules`の方針に沿った実装が進んでいる

---

## 4. デザインシステムの統一性

### 4.1 スペーシング・タイポグラフィ

**現状**:
- MUIのデフォルトスペーシング（4px基準）を使用
- タイポグラフィは`appTheme.js`で一部カスタマイズされているが、`main.jsx`の詳細設定は反映されていない

**問題**:
- フォントサイズの定義が不完全（`main.jsx`には詳細設定があるが未使用）
- レスポンシブ対応のフォントサイズ設定が統一されていない

### 4.2 コンポーネントの一貫性

**現状**:
- 主要コンポーネントはMUIコンポーネントを使用
- `sx` propでカスタマイズしているが、統一されたデザイントークンの使用が不十分

**問題**:
- 同じようなスタイルが複数コンポーネントで重複定義されている可能性
- カード、ボタン、テキストフィールドなどの共通スタイルがテーマに集約されていない

---

## 5. 改善の優先順位

### 高優先度（デザイン変更の基盤整備）

1. **テーマ設定の一元化**
   - `main.jsx`の未使用テーマ定義を削除、または`appTheme.js`に統合
   - テーマ設定を1箇所に集約

2. **ハードコードされた色のテーマ移行**
   - `PageHeader`コンポーネントの色をテーマパレットに移行
   - `index.css`のグローバルスタイルをテーマ設定に移行

3. **CSSファイルの削除・移行**
   - `TagStats.css`, `Stats.css`を削除し、`sx` propまたはMUIコンポーネントに移行
   - `!important`の使用を排除

### 中優先度（リファクタリングの容易性向上）

4. **テストコードのデザイン独立性向上**
   - `getByText`ベースのテストを`data-testid`ベースに移行
   - デザイン変更時にテストが壊れないようにする

5. **デザイントークンの整備**
   - カラーパレットの拡張（セマンティックカラー）
   - スペーシング、タイポグラフィの統一

### 低優先度（長期的な改善）

6. **コンポーネントスタイルの重複排除**
   - 共通スタイルをテーマの`components.styleOverrides`に集約
   - コンポーネント間の一貫性向上

---

## 6. 次のステップ

1. **改善計画の策定**: 上記の優先順位に基づいて、具体的な改善タスクを定義
2. **テーマ設計の見直し**: デザインシステムとして必要なトークンを洗い出し
3. **段階的なリファクタリング**: 影響範囲を考慮しながら、優先順位に従って改善を実施
4. **テストカバレッジの維持**: リファクタリング時にテストも同時に改善

---

## 参考資料

- `.cursorrules`: テスト記述方針
- `src/theme/appTheme.js`: 現在使用中のテーマ設定
- `src/main.jsx`: 未使用のテーマ定義（219-221行）
- `doc/component-design-guidelines.md`: コンポーネント設計ガイドライン（存在する場合）
