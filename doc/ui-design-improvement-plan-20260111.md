# UIデザイン改善計画

**作成日**: 2026-01-11  
**ベース**: `doc/ui-design-review-20260111.md`のレビュー結果  
**目的**: UIデザイン改善を段階的に実施するための具体的なタスク計画

---

## 改善計画の全体像

レビュー結果の優先順位に基づいて、以下の3フェーズで改善を実施します。

1. **Phase 1: 基盤整備**（高優先度）- デザイン変更の基盤を構築
2. **Phase 2: リファクタリング容易性向上**（中優先度）- テストとデザイントークンの整備
3. **Phase 3: 長期改善**（低優先度）- スタイルの重複排除と一貫性向上

---

## Phase 1: 基盤整備（高優先度）

デザイン変更を容易にするための基盤を構築します。

### Task 1.1: テーマ設定の一元化

**目的**: テーマ設定を1箇所に集約し、管理を容易にする

**現状の問題**:
- `src/main.jsx`に詳細なテーマ定義があるが使用されていない（219-221行）
- `src/theme/appTheme.js`が実際に使用されているが設定が簡素
- 2箇所に分散しているため、どちらを修正すべきか混乱する

**実施内容**:
1. `src/main.jsx`のテーマ定義を確認し、有用な設定を洗い出す
2. `src/theme/appTheme.js`に統合する形で設計
   - `main.jsx`の詳細設定（フォントサイズ、コンポーネントオーバーライド）を`appTheme.js`に統合
   - 不要な設定は削除
3. `src/main.jsx`からテーマ定義を削除し、`appTheme.js`をインポートする形に変更
4. 動作確認・テスト実行

**影響範囲**:
- `src/main.jsx`: テーマ定義部分を削除、インポート追加
- `src/theme/appTheme.js`: 設定の統合・拡張
- `src/App.jsx`: 既に`appTheme`を使用しているため変更不要

**完了条件**:
- テーマ設定が`appTheme.js`に一元化されている
- `main.jsx`のテーマ定義が削除されている
- アプリが正常に動作する（ビルド成功、テスト通過）

**推定作業時間**: 1-2時間

---

### Task 1.2: ハードコードされた色のテーマ移行

**目的**: ハードコードされた色をテーマパレットに移行し、デザイン変更を容易にする

**現状の問題**:
- `PageHeader`コンポーネントで多くの色がハードコードされている
- `index.css`のグローバルスタイルにも色がハードコードされている
- テーマ変更時に複数箇所を修正する必要がある

**実施内容**:

#### 1.2.1: テーマパレットの拡張

1. `appTheme.js`のパレットに必要な色を追加
   - PageHeader用のブラウン系カラー
   - テキスト色のバリエーション
   - 背景色のバリエーション

2. カスタムカラートークンを定義（必要に応じて）

#### 1.2.2: PageHeaderコンポーネントの修正

1. `src/components/common/PageHeader.jsx`を確認
2. ハードコードされた色をテーマパレット参照に変更
   - `rgba(139, 69, 19, 0.9)` → テーマカラー参照
   - `#8B4513`, `#A0522D`, `#CD853F` → テーマカラー参照
   - `#FFF8DC`, `#F5F5DC` → テーマカラー参照
3. 動作確認・テスト実行

#### 1.2.3: index.cssのグローバルスタイル修正

1. `src/index.css`のハードコード色を確認
2. 可能な限りテーマ設定に移行（グローバルスタイルは最小限に）
3. テーマ設定で対応できない部分のみCSSに残す

**影響範囲**:
- `src/theme/appTheme.js`: パレット拡張
- `src/components/common/PageHeader.jsx`: 色参照の変更
- `src/index.css`: グローバルスタイルの最小化
- テストファイル: 必要に応じて調整

**完了条件**:
- ハードコードされた色がテーマパレット参照に変更されている
- アプリの見た目が維持されている（視覚的回帰なし）
- テーマパレットを変更すると、関連コンポーネントの色も変更されることを確認

**推定作業時間**: 2-3時間

---

### Task 1.3: CSSファイルの削除・移行

**目的**: CSSファイルを削除し、MUIの`sx` propまたはコンポーネントに移行する

**現状の問題**:
- `TagStats.css`と`Stats.css`でクラス名ベースのスタイリングを使用
- `!important`を多用しており、テーマ設定との競合リスクがある
- テーマ変更時にCSSファイルも手動で修正する必要がある

**実施内容**:

#### 1.3.1: TagStats.cssの移行

1. `src/components/tags/TagStats.jsx`を確認
2. `.tag-stats-grid`のスタイルをMUIの`Grid`または`Box`の`sx` propに移行
3. `.tag-stat-card`のスタイルを`Card`コンポーネントの`sx` propに移行
4. `TagStats.css`を削除
5. 動作確認・テスト実行

#### 1.3.2: Stats.cssの移行

1. `src/pages/Stats.jsx`を確認
2. `.stats-summary-grid`のスタイルをMUIの`Grid`または`Box`の`sx` propに移行
3. `.stats-summary-card`のスタイルを`Card`コンポーネントの`sx` propに移行
4. `Stats.css`を削除
5. 動作確認・テスト実行

**影響範囲**:
- `src/components/tags/TagStats.jsx`: クラス名を削除、`sx` prop追加
- `src/components/tags/TagStats.css`: ファイル削除
- `src/pages/Stats.jsx`: クラス名を削除、`sx` prop追加
- `src/pages/Stats.css`: ファイル削除
- テストファイル: 必要に応じて調整（クラス名依存がある場合）

**完了条件**:
- CSSファイルが削除されている
- `!important`の使用が排除されている
- レイアウトとスタイルが維持されている（視覚的回帰なし）
- レスポンシブ対応が維持されている

**推定作業時間**: 2-3時間

---

## Phase 2: リファクタリング容易性向上（中優先度）

テストのデザイン独立性を向上させ、デザイントークンを整備します。

### Task 2.1: テストコードのデザイン独立性向上

**目的**: テストがデザイン変更に影響されないようにする

**現状の問題**:
- 多くのテストが`getByText()`で実装文字列を直接参照している
- `.cursorrules`の方針と矛盾している
- UIテキストを変更するとテストが失敗する

**実施内容**:

1. **影響を受けやすいテストファイルの洗い出し**
   - `BookCard.test.jsx`
   - `BookForm.test.jsx`
   - `ExternalBookSearch.test.jsx`
   - `MemoCard.test.jsx`
   - `MemoEditor.test.jsx`
   - `MemoAdd.test.jsx`
   - `FullTextSearch.test.jsx`
   - `PWAInstallPrompt.test.jsx`
   - `SearchResults.test.jsx`
   - `AdvancedSearchForm.test.jsx`

2. **各テストファイルの修正方針**
   - `getByText()`で実装文字列を参照している箇所を`getByTestId()`に変更
   - 必要に応じてコンポーネントに`data-testid`属性を追加
   - 表示テキストの検証が必要な場合は、テスト専用の属性（`data-display-text`など）を使用

3. **段階的な修正**
   - 優先度の高いテストファイルから順次修正
   - 各ファイル修正後にテストを実行し、動作を確認

**影響範囲**:
- 上記のテストファイル: `getByText()` → `getByTestId()`への変更
- 関連コンポーネント: `data-testid`属性の追加

**完了条件**:
- テストコードが実装文字列に依存していない
- すべてのテストが通過する
- UIテキストを変更してもテストが失敗しないことを確認

**推定作業時間**: 4-6時間（テストファイル数に応じて）

**注意**: このタスクは大規模になる可能性があるため、段階的に実施することを推奨

---

### Task 2.2: デザイントークンの整備

**目的**: デザインシステムとして必要なトークンを整備する

**実施内容**:

1. **カラーパレットの拡張**
   - セマンティックカラー（success, warning, info, error）の確認・拡張
   - カスタムカラーの定義（PageHeader用など）
   - ダークモード対応の検討（将来対応）

2. **スペーシングの統一**
   - MUIのデフォルトスペーシング（4px基準）の使用を確認
   - カスタムスペーシングが必要な場合は定義

3. **タイポグラフィの統一**
   - フォントサイズの定義を完全にする
   - レスポンシブ対応のフォントサイズ設定を統一
   - フォントファミリーの設定を確認

4. **ブレークポイントの確認**
   - レスポンシブブレークポイントの定義を確認
   - 必要に応じてカスタムブレークポイントを定義

**影響範囲**:
- `src/theme/appTheme.js`: トークンの追加・拡張

**完了条件**:
- 必要なデザイントークンがテーマに定義されている
- トークンが適切に使用されている

**推定作業時間**: 2-3時間

---

## Phase 3: 長期改善（低優先度）

コンポーネント間の一貫性を向上させます。

### Task 3.1: コンポーネントスタイルの重複排除

**目的**: 共通スタイルをテーマに集約し、コンポーネント間の一貫性を向上させる

**実施内容**:

1. **共通スタイルの洗い出し**
   - カード、ボタン、テキストフィールドなどの共通スタイルを調査
   - 複数コンポーネントで重複定義されているスタイルを特定

2. **テーマへの集約**
   - 共通スタイルを`components.styleOverrides`に移動
   - コンポーネントから重複スタイルを削除

3. **一貫性の確認**
   - コンポーネント間でスタイルが統一されていることを確認

**影響範囲**:
- `src/theme/appTheme.js`: 共通スタイルの追加
- 各コンポーネントファイル: 重複スタイルの削除

**完了条件**:
- 共通スタイルがテーマに集約されている
- コンポーネント間で一貫性が向上している

**推定作業時間**: 3-4時間

---

## 実施スケジュール

### 推奨実施順序

1. **Phase 1を優先**: 基盤整備により、以降の作業が容易になる
2. **Phase 2は段階的に**: テスト修正は大規模になるため、必要に応じて段階的に実施
3. **Phase 3は余裕があるときに**: 長期改善として、時間があるときに実施

### 推定総作業時間

- Phase 1: 5-8時間
- Phase 2: 6-9時間（テスト修正は段階的に）
- Phase 3: 3-4時間
- **合計**: 14-21時間

---

## 各タスクの依存関係

```
Task 1.1 (テーマ一元化)
  ↓
Task 1.2 (ハードコード色の移行) ← Task 1.1の完了を前提
  ↓
Task 1.3 (CSSファイル削除)
  ↓
Task 2.1 (テスト独立性向上) ← Phase 1完了後、必要に応じて
Task 2.2 (デザイントークン整備) ← Task 1.2と並行可能
  ↓
Task 3.1 (スタイル重複排除) ← Phase 1, 2完了後
```

---

## 次のアクション

1. **Task 1.1から開始**: テーマ設定の一元化
2. 各タスク完了後に動作確認・テスト実行
3. 必要に応じてドキュメントを更新

---

## 参考資料

- `doc/ui-design-review-20260111.md`: レビュー結果
- `src/theme/appTheme.js`: 現在のテーマ設定
- `src/main.jsx`: 未使用のテーマ定義（Task 1.1で統合予定）
- `.cursorrules`: テスト記述方針
