# 実装コスト評価: 書籍削除機能とアカウント/プロフィールページ

## 1. 書籍データの削除機能

### 現状の調査結果

#### 既存実装
- ✅ **Firestoreセキュリティルール**: 書籍削除の権限が既に設定済み（`firestore.rules`の33行目）
- ✅ **メモ削除機能**: 既存の`useMemo.js`の`deleteMemo`関数を参考にできる
- ✅ **削除確認ダイアログ**: `MemoList.jsx`に削除確認ダイアログの実装パターンがある
- ✅ **参考実装**: `scripts/resetTestBooks.cjs`に書籍とメモの削除処理がある（サブコレクション対応）
- ❌ **`useBook.js`フック**: `deleteBook`関数が未実装（`updateBook`, `updateBookStatus`, `updateBookTags`のみ）

#### データ構造
- 書籍（`books/{bookId}`）のサブコレクションとして`memos`が存在
- **削除制約**: メモが存在する場合は書籍を削除できない（ユーザー要望）

#### 実装方法（メモ存在確認）
```javascript
// useBook.js の deleteBook 関数内で実装
const memosRef = collection(db, 'books', bookId, 'memos');
const memosSnapshot = await getDocs(memosRef);
if (!memosSnapshot.empty) {
  throw new Error('この書籍にはメモが含まれているため、削除できません。先にメモを削除してください。');
}
// メモが無い場合のみ削除処理を実行
await deleteDoc(doc(db, 'books', bookId));
```

### 実装コスト評価

#### 作業項目

1. **`src/hooks/useBook.js`の拡張**
   - `deleteBook`関数の実装
   - **メモ存在確認**: 削除前に`collection(db, 'books', bookId, 'memos')`をクエリしてメモの存在を確認
   - **制約**: メモがある場合はエラーをthrow（`setGlobalError`でユーザーに通知）
   - メモが無い場合のみ削除を実行（Firestoreから書籍を削除）
   - エラーハンドリング
   - **推定工数**: 0.5日

2. **`src/pages/BookDetail.jsx`の修正**
   - 削除ボタンの追加（UI配置の検討が必要）
   - 削除確認ダイアログの追加（既存パターンを流用）
   - 削除処理の呼び出しとエラーハンドリング（メモがある場合のエラー通知）
   - 削除後のナビゲーション処理（書籍一覧ページへリダイレクト）
   - **推定工数**: 0.5日

3. **テストの実装**
   - `useBook.test.js`（`deleteBook`関数のテスト）
   - `BookDetail.test.jsx`（削除UI・削除確認ダイアログのテスト）
   - **推定工数**: 0.5日

#### 合計推定工数
- **最小**: 1日（既存パターンを最大限活用）
- **標準**: 1.5日（UI配置の検討・テスト含む）

#### 実装の複雑度
- **技術的難易度**: 低〜中
  - Firestoreのサブコレクション削除処理が必要
  - 既存のメモ削除機能と同様のパターンで実装可能
- **既存コードへの影響**: 低
  - 新規機能追加のみ
  - 既存機能への影響なし

#### 注意事項
- **メモ存在確認**: 削除前に`collection(db, 'books', bookId, 'memos')`をクエリしてメモの存在を確認
- **削除制約**: メモがある場合は削除を拒否し、エラーメッセージを表示（例：「この書籍にはメモが含まれているため、削除できません。先にメモを削除してください。」）
- **エラー通知**: `ErrorDialogContext`の`setGlobalError`を使用してユーザーに通知（既存パターン）
- 削除後のUI/UX検討（書籍一覧ページへの遷移タイミングなど）
- 削除確認ダイアログの文言・UIは既存のメモ削除と統一

---

## 2. アカウント（ユーザープロフィール）確認ページの追加

### 現状の調査結果

#### 既存実装
- ✅ **Firebase Authentication**: `AuthProvider.jsx`で`user`オブジェクトを提供（`user.email`, `user.displayName`, `user.uid`など）
- ✅ **ボトムナビゲーション**: `AppBottomNav`に`PersonIcon`が存在するが、対応するルートが未定義
- ❌ **プロフィールページ**: `src/pages`に存在しない
- ❌ **ルート定義**: `App.jsx`にプロフィールページのルートが未定義
- ⚠️ **ARCHITECTURE.md**: 「設定画面（アカウント情報・ログアウト・データエクスポート等）」が記載されているが未実装

#### データ構造
- Firebase Authenticationの`user`オブジェクトから基本情報を取得可能
- Firestoreの`users/{userId}`コレクションのルールは定義済み（使用状況は不明）

### 実装コスト評価

#### 作業項目

1. **`src/pages/Profile.jsx`の作成**
   - ユーザー情報の表示（メールアドレス、表示名、UIDなど）
   - Firebase Authenticationの`user`オブジェクトから情報を取得
   - ログアウト機能の追加（Firebase Authenticationの`signOut`）
   - **推定工数**: 0.5〜1日

2. **`src/App.jsx`の修正**
   - プロフィールページのルート追加（`/profile`など）
   - `AppBottomNav`の`PersonIcon`にナビゲーション処理を追加
   - **推定工数**: 0.2日

3. **UI/UXの検討**
   - プロフィールページのレイアウト・デザイン
   - 表示する情報の選定（メールアドレス、表示名、アカウント作成日など）
   - ログアウトボタンの配置
   - **推定工数**: 0.3日（既存ページのデザインパターンを流用）

4. **テストの実装**
   - `Profile.test.jsx`の作成（ユーザー情報表示、ログアウト機能のテスト）
   - **推定工数**: 0.5日

#### 合計推定工数
- **最小**: 1.5日（シンプルな情報表示のみ）
- **標準**: 2日（ログアウト機能・テスト含む）
- **拡張**: 2.5〜3日（追加機能含む: データエクスポート、設定変更など）

#### 実装の複雑度
- **技術的難易度**: 低
  - Firebase Authenticationの標準機能のみ使用
  - 既存のページコンポーネントのパターンを流用可能
- **既存コードへの影響**: 低
  - 新規ページ追加のみ
  - 既存機能への影響なし

#### 注意事項
- **表示する情報の選定**: メールアドレス、表示名、UID、アカウント作成日など
- **ログアウト機能**: Firebase Authenticationの`signOut`を使用（`useAuth`フックへの追加も検討）
- **ボトムナビゲーション**: 既存の`AppBottomNav`に`PersonIcon`があるが、対応するルートが未定義（`value`の管理も追加が必要）
- **将来の拡張**: データエクスポート、設定変更、アカウント削除などの機能追加の余地

---

## 総合評価

### 優先度の検討

#### 書籍削除機能
- **実装コスト**: 低〜中（1〜1.5日）
- **技術的難易度**: 低〜中
- **ユーザー価値**: 高（不要な書籍データの削除は基本的な機能）
- **推奨**: **優先度高**

#### アカウント/プロフィールページ
- **実装コスト**: 低（1.5〜2日）
- **技術的難易度**: 低
- **ユーザー価値**: 中（アカウント情報の確認、ログアウト機能）
- **推奨**: **優先度中**（ボトムナビにアイコンがあるため、実装すると一貫性が向上）

### 実装順序の提案

1. **書籍削除機能**（優先度高）
   - 基本的な機能として早期実装を推奨
   - 既存のメモ削除機能と同様のパターンで実装可能

2. **アカウント/プロフィールページ**（優先度中）
   - ボトムナビにアイコンがあるため、一貫性の観点から実装を推奨
   - ログアウト機能も併せて実装するとユーザビリティが向上

### 注意事項

- 両機能とも既存コードへの影響は低い（新規機能追加のみ）
- 既存のパターンやコンポーネントを最大限活用できる
- テストの実装も既存パターンを流用可能
